{"ast":null,"code":"import _regeneratorRuntime from \"/Users/kazuaki.aihara/Documents/GCP-access/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/kazuaki.aihara/Documents/GCP-access/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.array.join.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport api from \"../api/api.js\";\n// import axios from \"axios\";\n\nexport default {\n  name: \"tableView\",\n  components: {},\n  data: function data() {\n    return {\n      sqlQuery: \"\",\n      errorMessage: \"\",\n      results: [],\n      columns: []\n    };\n  },\n  mounted: function mounted() {},\n  computed: {},\n  methods: {\n    executeQuery: function executeQuery() {\n      var _this = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return api.post(\"/api/execute-sql\", {\n                sql: _this.sqlQuery\n              });\n            case 3:\n              response = _context.sent;\n              _this.results = response.data.results;\n              if (_this.results.length > 0) {\n                _this.columns = Object.keys(_this.results[0]).map(function (key) {\n                  return {\n                    label: key,\n                    field: key\n                  };\n                });\n              } else {\n                _this.columns = [];\n              }\n              _this.errorMessage = \"\";\n              _context.next = 14;\n              break;\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](0);\n              _this.errorMessage = \"Error executing query: \" + _context.t0.message;\n              _this.results = [];\n              _this.columns = [];\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[0, 9]]);\n      }))();\n    },\n    downloadCSV: function downloadCSV() {\n      var _this2 = this;\n      var headers = this.columns.map(function (col) {\n        return col.label;\n      }).join(\",\");\n      var rows = this.results.map(function (row) {\n        return _this2.columns.map(function (col) {\n          return row[col.field];\n        }).join(\",\");\n      }).join(\"\\n\");\n      var csvContent = \"data:text/csv;charset=utf-8,\".concat(headers, \"\\n\").concat(rows);\n      var encodedUri = encodeURI(csvContent);\n      var link = document.createElement(\"a\");\n      link.setAttribute(\"href\", encodedUri);\n      link.setAttribute(\"download\", \"results.csv\");\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;AAyCA,OAAOA,GAAE,MAAO,eAAe;AAC/B;;AAEA,eAAe;EACbC,IAAI,EAAE,WAAW;EACjBC,UAAU,EAAE,CAAC,CAAC;EACdC,IAAI,kBAAG;IACL,OAAO;MACLC,QAAQ,EAAE,EAAE;MACZC,YAAY,EAAE,EAAE;MAChBC,OAAO,EAAE,EAAE;MACXC,OAAO,EAAE;IACX,CAAC;EACH,CAAC;EACDC,OAAO,qBAAG,CAAC,CAAC;EACZC,QAAQ,EAAE,CAAC,CAAC;EACZC,OAAO,EAAE;IACDC,YAAY,0BAAG;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;cAAA;cAAA,OAEMX,GAAG,CAACY,IAAI,CAAC,kBAAkB,EAAE;gBAClDC,GAAG,EAAE,KAAI,CAACT;cACZ,CAAC,CAAC;YAAA;cAFIU,QAAO;cAGb,KAAI,CAACR,OAAM,GAAIQ,QAAQ,CAACX,IAAI,CAACG,OAAO;cACpC,IAAI,KAAI,CAACA,OAAO,CAACS,MAAK,GAAI,CAAC,EAAE;gBAC3B,KAAI,CAACR,OAAM,GAAIS,MAAM,CAACC,IAAI,CAAC,KAAI,CAACX,OAAO,CAAC,CAAC,CAAC,CAAC,CAACY,GAAG,CAAC,UAACC,GAAG;kBAAA,OAAM;oBACxDC,KAAK,EAAED,GAAG;oBACVE,KAAK,EAAEF;kBACT,CAAC;gBAAA,CAAC,CAAC;cACL,OAAO;gBACL,KAAI,CAACZ,OAAM,GAAI,EAAE;cACnB;cACA,KAAI,CAACF,YAAW,GAAI,EAAE;cAAA;cAAA;YAAA;cAAA;cAAA;cAEtB,KAAI,CAACA,YAAW,GAAI,yBAAwB,GAAI,YAAMiB,OAAO;cAC7D,KAAI,CAAChB,OAAM,GAAI,EAAE;cACjB,KAAI,CAACC,OAAM,GAAI,EAAE;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAErB,CAAC;IACDgB,WAAW,yBAAG;MAAA;MACZ,IAAMC,OAAM,GAAI,IAAI,CAACjB,OAAO,CAACW,GAAG,CAAC,UAACO,GAAG;QAAA,OAAKA,GAAG,CAACL,KAAK;MAAA,EAAC,CAACM,IAAI,CAAC,GAAG,CAAC;MAC9D,IAAMC,IAAG,GAAI,IAAI,CAACrB,OAAM,CACrBY,GAAG,CAAC,UAACU,GAAG;QAAA,OAAK,MAAI,CAACrB,OAAO,CAACW,GAAG,CAAC,UAACO,GAAG;UAAA,OAAKG,GAAG,CAACH,GAAG,CAACJ,KAAK,CAAC;QAAA,EAAC,CAACK,IAAI,CAAC,GAAG,CAAC;MAAA,GAChEA,IAAI,CAAC,IAAI,CAAC;MACb,IAAMG,UAAS,yCAAmCL,OAAO,eAAKG,IAAI,CAAE;MACpE,IAAMG,UAAS,GAAIC,SAAS,CAACF,UAAU,CAAC;MACxC,IAAMG,IAAG,GAAIC,QAAQ,CAACC,aAAa,CAAC,GAAG,CAAC;MACxCF,IAAI,CAACG,YAAY,CAAC,MAAM,EAAEL,UAAU,CAAC;MACrCE,IAAI,CAACG,YAAY,CAAC,UAAU,EAAE,aAAa,CAAC;MAC5CF,QAAQ,CAACG,IAAI,CAACC,WAAW,CAACL,IAAI,CAAC;MAC/BA,IAAI,CAACM,KAAK,EAAE;MACZL,QAAQ,CAACG,IAAI,CAACG,WAAW,CAACP,IAAI,CAAC;IACjC;EACF;AACF,CAAC","names":["api","name","components","data","sqlQuery","errorMessage","results","columns","mounted","computed","methods","executeQuery","post","sql","response","length","Object","keys","map","key","label","field","message","downloadCSV","headers","col","join","rows","row","csvContent","encodedUri","encodeURI","link","document","createElement","setAttribute","body","appendChild","click","removeChild"],"sourceRoot":"","sources":["/Users/kazuaki.aihara/Documents/GCP-access/src/views/Query.vue"],"sourcesContent":["<template>\n  <div class=\"campaign_analize\">\n    <!-- side var  -->\n    <SideVar />\n    <!-- main div -->\n    <RightColumnOutline>\n      <PageTitle>本番データ取得</PageTitle>\n      <div class=\"container mx-auto p-4\">\n        <h1 class=\"text-2xl font-bold mb-4 text-white\">Qeury -> BigQuery</h1>\n        <div class=\"mb-4\">\n          <textarea\n            v-model=\"sqlQuery\"\n            class=\"w-full p-2 border rounded\"\n            rows=\"5\"\n            placeholder=\"Enter your SQL query here\"\n          ></textarea>\n        </div>\n        <button\n          class=\"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded\"\n        >\n          クエリ実行\n        </button>\n\n        <div v-if=\"errorMessage\" class=\"mt-4 text-red-500\">\n          {{ errorMessage }}\n        </div>\n\n        <div v-if=\"results.length\" class=\"mt-4\">\n          <easy-data-table :data=\"results\" :columns=\"columns\"></easy-data-table>\n          <button\n            class=\"mt-2 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded\"\n          >\n            Download CSV\n          </button>\n        </div>\n      </div>\n    </RightColumnOutline>\n  </div>\n</template>\n\n<script>\nimport api from \"../api/api.js\";\n// import axios from \"axios\";\n\nexport default {\n  name: \"tableView\",\n  components: {},\n  data() {\n    return {\n      sqlQuery: \"\",\n      errorMessage: \"\",\n      results: [],\n      columns: [],\n    };\n  },\n  mounted() {},\n  computed: {},\n  methods: {\n    async executeQuery() {\n      try {\n        const response = await api.post(\"/api/execute-sql\", {\n          sql: this.sqlQuery,\n        });\n        this.results = response.data.results;\n        if (this.results.length > 0) {\n          this.columns = Object.keys(this.results[0]).map((key) => ({\n            label: key,\n            field: key,\n          }));\n        } else {\n          this.columns = [];\n        }\n        this.errorMessage = \"\";\n      } catch (error) {\n        this.errorMessage = \"Error executing query: \" + error.message;\n        this.results = [];\n        this.columns = [];\n      }\n    },\n    downloadCSV() {\n      const headers = this.columns.map((col) => col.label).join(\",\");\n      const rows = this.results\n        .map((row) => this.columns.map((col) => row[col.field]).join(\",\"))\n        .join(\"\\n\");\n      const csvContent = `data:text/csv;charset=utf-8,${headers}\\n${rows}`;\n      const encodedUri = encodeURI(csvContent);\n      const link = document.createElement(\"a\");\n      link.setAttribute(\"href\", encodedUri);\n      link.setAttribute(\"download\", \"results.csv\");\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    },\n  },\n};\n</script>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}