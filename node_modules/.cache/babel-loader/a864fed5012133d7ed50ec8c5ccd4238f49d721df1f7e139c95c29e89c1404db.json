{"ast":null,"code":"import _regeneratorRuntime from \"/Users/kazuaki.aihara/Documents/GCP-access/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/kazuaki.aihara/Documents/GCP-access/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.array.join.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport api from \"../api/api.js\";\n// import axios from \"axios\";\n\nexport default {\n  name: \"tableView\",\n  components: {},\n  data: function data() {\n    return {\n      sqlQuery: \"\",\n      errorMessage: \"\",\n      results: [],\n      columns: []\n    };\n  },\n  mounted: function mounted() {},\n  computed: {},\n  methods: {\n    executeQuery: function executeQuery() {\n      var _this = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              api.postBigquery({\n                SQL: _this.sqlQuery\n              }).then(function (response) {\n                _this.results = response.data;\n                if (_this.results.length > 0) {\n                  _this.columns = Object.keys(_this.results[0]).map(function (key) {\n                    return {\n                      label: key,\n                      field: key\n                    };\n                  });\n                } else {\n                  _this.columns = [];\n                }\n                _this.errorMessage = \"\";\n              })[\"catch\"](function (error) {\n                _this.errorMessage = \"Error executing query: \" + error.message;\n                _this.results = [];\n                _this.columns = [];\n              });\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }))();\n    }\n  },\n  downloadCSV: function downloadCSV() {\n    var _this2 = this;\n    var headers = this.columns.map(function (col) {\n      return col.label;\n    }).join(\",\");\n    var rows = this.results.map(function (row) {\n      return _this2.columns.map(function (col) {\n        return row[col.field];\n      }).join(\",\");\n    }).join(\"\\n\");\n    var csvContent = \"data:text/csv;charset=utf-8,\".concat(headers, \"\\n\").concat(rows);\n    var encodedUri = encodeURI(csvContent);\n    var link = document.createElement(\"a\");\n    link.setAttribute(\"href\", encodedUri);\n    link.setAttribute(\"download\", \"results.csv\");\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  }\n};","map":{"version":3,"mappings":";;;;;;AAyCA,OAAOA,GAAE,MAAO,eAAe;AAC/B;;AAEA,eAAe;EACbC,IAAI,EAAE,WAAW;EACjBC,UAAU,EAAE,CAAC,CAAC;EACdC,IAAI,kBAAG;IACL,OAAO;MACLC,QAAQ,EAAE,EAAE;MACZC,YAAY,EAAE,EAAE;MAChBC,OAAO,EAAE,EAAE;MACXC,OAAO,EAAE;IACX,CAAC;EACH,CAAC;EACDC,OAAO,qBAAG,CAAC,CAAC;EACZC,QAAQ,EAAE,CAAC,CAAC;EACZC,OAAO,EAAE;IACDC,YAAY,0BAAG;MAAA;MAAA;QAAA;UAAA;YAAA;cACnBX,GAAE,CACCY,YAAY,CAAC;gBAAEC,GAAG,EAAE,KAAI,CAACT;cAAS,CAAC,EACnCU,IAAI,CAAC,UAACC,QAAQ,EAAK;gBAClB,KAAI,CAACT,OAAM,GAAIS,QAAQ,CAACZ,IAAI;gBAC5B,IAAI,KAAI,CAACG,OAAO,CAACU,MAAK,GAAI,CAAC,EAAE;kBAC3B,KAAI,CAACT,OAAM,GAAIU,MAAM,CAACC,IAAI,CAAC,KAAI,CAACZ,OAAO,CAAC,CAAC,CAAC,CAAC,CAACa,GAAG,CAAC,UAACC,GAAG;oBAAA,OAAM;sBACxDC,KAAK,EAAED,GAAG;sBACVE,KAAK,EAAEF;oBACT,CAAC;kBAAA,CAAC,CAAC;gBACL,OAAO;kBACL,KAAI,CAACb,OAAM,GAAI,EAAE;gBACnB;gBACA,KAAI,CAACF,YAAW,GAAI,EAAE;cACxB,CAAC,UACK,CAAC,UAACkB,KAAK,EAAK;gBAChB,KAAI,CAAClB,YAAW,GAAI,yBAAwB,GAAIkB,KAAK,CAACC,OAAO;gBAC7D,KAAI,CAAClB,OAAM,GAAI,EAAE;gBACjB,KAAI,CAACC,OAAM,GAAI,EAAE;cACnB,CAAC,CAAC;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IACN;EACF,CAAC;EACDkB,WAAW,yBAAG;IAAA;IACZ,IAAMC,OAAM,GAAI,IAAI,CAACnB,OAAO,CAACY,GAAG,CAAC,UAACQ,GAAG;MAAA,OAAKA,GAAG,CAACN,KAAK;IAAA,EAAC,CAACO,IAAI,CAAC,GAAG,CAAC;IAC9D,IAAMC,IAAG,GAAI,IAAI,CAACvB,OAAM,CACrBa,GAAG,CAAC,UAACW,GAAG;MAAA,OAAK,MAAI,CAACvB,OAAO,CAACY,GAAG,CAAC,UAACQ,GAAG;QAAA,OAAKG,GAAG,CAACH,GAAG,CAACL,KAAK,CAAC;MAAA,EAAC,CAACM,IAAI,CAAC,GAAG,CAAC;IAAA,GAChEA,IAAI,CAAC,IAAI,CAAC;IACb,IAAMG,UAAS,yCAAmCL,OAAO,eAAKG,IAAI,CAAE;IACpE,IAAMG,UAAS,GAAIC,SAAS,CAACF,UAAU,CAAC;IACxC,IAAMG,IAAG,GAAIC,QAAQ,CAACC,aAAa,CAAC,GAAG,CAAC;IACxCF,IAAI,CAACG,YAAY,CAAC,MAAM,EAAEL,UAAU,CAAC;IACrCE,IAAI,CAACG,YAAY,CAAC,UAAU,EAAE,aAAa,CAAC;IAC5CF,QAAQ,CAACG,IAAI,CAACC,WAAW,CAACL,IAAI,CAAC;IAC/BA,IAAI,CAACM,KAAK,EAAE;IACZL,QAAQ,CAACG,IAAI,CAACG,WAAW,CAACP,IAAI,CAAC;EACjC;AACF,CAAC","names":["api","name","components","data","sqlQuery","errorMessage","results","columns","mounted","computed","methods","executeQuery","postBigquery","SQL","then","response","length","Object","keys","map","key","label","field","error","message","downloadCSV","headers","col","join","rows","row","csvContent","encodedUri","encodeURI","link","document","createElement","setAttribute","body","appendChild","click","removeChild"],"sourceRoot":"","sources":["/Users/kazuaki.aihara/Documents/GCP-access/src/views/Query.vue"],"sourcesContent":["<template>\n  <div class=\"campaign_analize\">\n    <!-- side var  -->\n    <SideVar />\n    <!-- main div -->\n    <RightColumnOutline>\n      <PageTitle>本番データ取得</PageTitle>\n      <div class=\"container mx-auto p-4\">\n        <h1 class=\"text-2xl font-bold mb-4 text-white\">Qeury -> BigQuery</h1>\n        <div class=\"mb-4\">\n          <textarea\n            v-model=\"sqlQuery\"\n            class=\"w-full p-2 border rounded\"\n            rows=\"5\"\n            placeholder=\"Enter your SQL query here\"\n          ></textarea>\n        </div>\n        <button\n          class=\"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded\"\n        >\n          クエリ実行\n        </button>\n\n        <div v-if=\"errorMessage\" class=\"mt-4 text-red-500\">\n          {{ errorMessage }}\n        </div>\n\n        <div v-if=\"results.length\" class=\"mt-4\">\n          <easy-data-table :data=\"results\" :columns=\"columns\"></easy-data-table>\n          <button\n            class=\"mt-2 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded\"\n          >\n            Download CSV\n          </button>\n        </div>\n      </div>\n    </RightColumnOutline>\n  </div>\n</template>\n\n<script>\nimport api from \"../api/api.js\";\n// import axios from \"axios\";\n\nexport default {\n  name: \"tableView\",\n  components: {},\n  data() {\n    return {\n      sqlQuery: \"\",\n      errorMessage: \"\",\n      results: [],\n      columns: [],\n    };\n  },\n  mounted() {},\n  computed: {},\n  methods: {\n    async executeQuery() {\n      api\n        .postBigquery({ SQL: this.sqlQuery })\n        .then((response) => {\n          this.results = response.data;\n          if (this.results.length > 0) {\n            this.columns = Object.keys(this.results[0]).map((key) => ({\n              label: key,\n              field: key,\n            }));\n          } else {\n            this.columns = [];\n          }\n          this.errorMessage = \"\";\n        })\n        .catch((error) => {\n          this.errorMessage = \"Error executing query: \" + error.message;\n          this.results = [];\n          this.columns = [];\n        });\n    },\n  },\n  downloadCSV() {\n    const headers = this.columns.map((col) => col.label).join(\",\");\n    const rows = this.results\n      .map((row) => this.columns.map((col) => row[col.field]).join(\",\"))\n      .join(\"\\n\");\n    const csvContent = `data:text/csv;charset=utf-8,${headers}\\n${rows}`;\n    const encodedUri = encodeURI(csvContent);\n    const link = document.createElement(\"a\");\n    link.setAttribute(\"href\", encodedUri);\n    link.setAttribute(\"download\", \"results.csv\");\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  },\n};\n</script>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}