{"ast":null,"code":"import _regeneratorRuntime from \"/Users/kazuaki.aihara/Documents/GCP-access/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/kazuaki.aihara/Documents/GCP-access/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.array.join.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport api from \"../api/api.js\";\nexport default {\n  name: \"tableView\",\n  components: {},\n  data: function data() {\n    return {\n      sqlQuery: \"\",\n      errorMessage: \"\",\n      results: [],\n      columns: []\n    };\n  },\n  mounted: function mounted() {\n    this.getevents();\n    this.show_flag = true;\n  },\n  computed: {\n    authority: function authority() {\n      return this.$store.getters[\"authority\"];\n    }\n  },\n  methods: {\n    executeQuery: function executeQuery() {\n      var _this = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return axios.post('/api/execute-sql', {\n                sql: _this.sqlQuery\n              });\n            case 3:\n              response = _context.sent;\n              _this.results = response.data.results;\n              if (_this.results.length > 0) {\n                _this.columns = Object.keys(_this.results[0]).map(function (key) {\n                  return {\n                    label: key,\n                    field: key\n                  };\n                });\n              } else {\n                _this.columns = [];\n              }\n              _this.errorMessage = '';\n              _context.next = 14;\n              break;\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](0);\n              _this.errorMessage = 'Error executing query: ' + _context.t0.message;\n              _this.results = [];\n              _this.columns = [];\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[0, 9]]);\n      }))();\n    },\n    downloadCSV: function downloadCSV() {\n      var _this2 = this;\n      var headers = this.columns.map(function (col) {\n        return col.label;\n      }).join(',');\n      var rows = this.results.map(function (row) {\n        return _this2.columns.map(function (col) {\n          return row[col.field];\n        }).join(',');\n      }).join('\\n');\n      var csvContent = \"data:text/csv;charset=utf-8,\".concat(headers, \"\\n\").concat(rows);\n      var encodedUri = encodeURI(csvContent);\n      var link = document.createElement('a');\n      link.setAttribute('href', encodedUri);\n      link.setAttribute('download', 'results.csv');\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;AAyCA,OAAOA,GAAE,MAAO,eAAe;AAE/B,eAAe;EACbC,IAAI,EAAE,WAAW;EACjBC,UAAU,EAAE,CAAC,CAAC;EACdC,IAAI,kBAAG;IACL,OAAO;MACLC,QAAQ,EAAE,EAAE;MACZC,YAAY,EAAE,EAAE;MAChBC,OAAO,EAAE,EAAE;MACXC,OAAO,EAAE;IACX,CAAC;EACH,CAAC;EACDC,OAAO,qBAAG;IACR,IAAI,CAACC,SAAS,EAAE;IAChB,IAAI,CAACC,SAAQ,GAAI,IAAI;EACvB,CAAC;EACDC,QAAQ,EAAE;IACRC,SAAS,EAAE,qBAAY;MACrB,OAAO,IAAI,CAACC,MAAM,CAACC,OAAO,CAAC,WAAW,CAAC;IACzC;EACF,CAAC;EACDC,OAAO,EAAE;IACDC,YAAY,0BAAG;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;cAAA;cAAA,OAEMC,KAAK,CAACC,IAAI,CAAC,kBAAkB,EAAE;gBAAEC,GAAG,EAAE,KAAI,CAACf;cAAS,CAAC,CAAC;YAAA;cAAvEgB,QAAO;cACb,KAAI,CAACd,OAAM,GAAIc,QAAQ,CAACjB,IAAI,CAACG,OAAO;cACpC,IAAI,KAAI,CAACA,OAAO,CAACe,MAAK,GAAI,CAAC,EAAE;gBAC3B,KAAI,CAACd,OAAM,GAAIe,MAAM,CAACC,IAAI,CAAC,KAAI,CAACjB,OAAO,CAAC,CAAC,CAAC,CAAC,CAACkB,GAAG,CAAC,aAAE;kBAAA,OAAM;oBAAEC,KAAK,EAAEC,GAAG;oBAAEC,KAAK,EAAED;kBAAI,CAAC;gBAAA,CAAC,CAAC;cACtF,OAAO;gBACL,KAAI,CAACnB,OAAM,GAAI,EAAE;cACnB;cACA,KAAI,CAACF,YAAW,GAAI,EAAE;cAAA;cAAA;YAAA;cAAA;cAAA;cAEtB,KAAI,CAACA,YAAW,GAAI,yBAAwB,GAAI,YAAMuB,OAAO;cAC7D,KAAI,CAACtB,OAAM,GAAI,EAAE;cACjB,KAAI,CAACC,OAAM,GAAI,EAAE;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAErB,CAAC;IACDsB,WAAW,yBAAG;MAAA;MACZ,IAAMC,OAAM,GAAI,IAAI,CAACvB,OAAO,CAACiB,GAAG,CAAC,aAAE;QAAA,OAAKO,GAAG,CAACN,KAAK;MAAA,EAAC,CAACO,IAAI,CAAC,GAAG,CAAC;MAC5D,IAAMC,IAAG,GAAI,IAAI,CAAC3B,OAAO,CAACkB,GAAG,CAAC,aAAE;QAAA,OAAK,MAAI,CAACjB,OAAO,CAACiB,GAAG,CAAC,aAAE;UAAA,OAAKU,GAAG,CAACH,GAAG,CAACJ,KAAK,CAAC;QAAA,EAAC,CAACK,IAAI,CAAC,GAAG,CAAC;MAAA,EAAC,CAACA,IAAI,CAAC,IAAI,CAAC;MAClG,IAAMG,UAAS,yCAAmCL,OAAO,eAAKG,IAAI,CAAE;MACpE,IAAMG,UAAS,GAAIC,SAAS,CAACF,UAAU,CAAC;MACxC,IAAMG,IAAG,GAAIC,QAAQ,CAACC,aAAa,CAAC,GAAG,CAAC;MACxCF,IAAI,CAACG,YAAY,CAAC,MAAM,EAAEL,UAAU,CAAC;MACrCE,IAAI,CAACG,YAAY,CAAC,UAAU,EAAE,aAAa,CAAC;MAC5CF,QAAQ,CAACG,IAAI,CAACC,WAAW,CAACL,IAAI,CAAC;MAC/BA,IAAI,CAACM,KAAK,EAAE;MACZL,QAAQ,CAACG,IAAI,CAACG,WAAW,CAACP,IAAI,CAAC;IACjC;EACF;AACF,CAAC","names":["api","name","components","data","sqlQuery","errorMessage","results","columns","mounted","getevents","show_flag","computed","authority","$store","getters","methods","executeQuery","axios","post","sql","response","length","Object","keys","map","label","key","field","message","downloadCSV","headers","col","join","rows","row","csvContent","encodedUri","encodeURI","link","document","createElement","setAttribute","body","appendChild","click","removeChild"],"sourceRoot":"","sources":["/Users/kazuaki.aihara/Documents/GCP-access/src/views/Query.vue"],"sourcesContent":["<template>\n  <div class=\"campaign_analize\">\n    <!-- side var  -->\n    <SideVar />\n    <!-- main div -->\n    <RightColumnOutline>\n      <PageTitle>本番データ取得</PageTitle>\n      <div class=\"container mx-auto p-4\">\n        <h1 class=\"text-2xl font-bold mb-4\">BigQuery SQL Executor</h1>\n        <div class=\"mb-4\">\n          <textarea\n            v-model=\"sqlQuery\"\n            class=\"w-full p-2 border rounded\"\n            rows=\"5\"\n            placeholder=\"Enter your SQL query here\"\n          ></textarea>\n        </div>\n        <button\n          class=\"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded\"\n        >\n          Execute Query\n        </button>\n\n        <div v-if=\"errorMessage\" class=\"mt-4 text-red-500\">\n          {{ errorMessage }}\n        </div>\n\n        <div v-if=\"results.length\" class=\"mt-4\">\n          <easy-data-table :data=\"results\" :columns=\"columns\"></easy-data-table>\n          <button\n            class=\"mt-2 bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded\"\n          >\n            Download CSV\n          </button>\n        </div>\n      </div>\n    </RightColumnOutline>\n  </div>\n</template>\n\n<script>\nimport api from \"../api/api.js\";\n\nexport default {\n  name: \"tableView\",\n  components: {},\n  data() {\n    return {\n      sqlQuery: \"\",\n      errorMessage: \"\",\n      results: [],\n      columns: [],\n    };\n  },\n  mounted() {\n    this.getevents();\n    this.show_flag = true;\n  },\n  computed: {\n    authority: function () {\n      return this.$store.getters[\"authority\"];\n    },\n  },\n  methods: {\n    async executeQuery() {\n      try {\n        const response = await axios.post('/api/execute-sql', { sql: this.sqlQuery });\n        this.results = response.data.results;\n        if (this.results.length > 0) {\n          this.columns = Object.keys(this.results[0]).map(key => ({ label: key, field: key }));\n        } else {\n          this.columns = [];\n        }\n        this.errorMessage = '';\n      } catch (error) {\n        this.errorMessage = 'Error executing query: ' + error.message;\n        this.results = [];\n        this.columns = [];\n      }\n    },\n    downloadCSV() {\n      const headers = this.columns.map(col => col.label).join(',');\n      const rows = this.results.map(row => this.columns.map(col => row[col.field]).join(',')).join('\\n');\n      const csvContent = `data:text/csv;charset=utf-8,${headers}\\n${rows}`;\n      const encodedUri = encodeURI(csvContent);\n      const link = document.createElement('a');\n      link.setAttribute('href', encodedUri);\n      link.setAttribute('download', 'results.csv');\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    },\n  },\n};\n</script>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}